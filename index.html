<!DOCTYPE html>
<html lang="zh-Hant-TW">
	<head>
		<meta charset="UTF-8">
		<title>Neko Image Creater</title>
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<script>window.$ = window.jQuery = require('jquery');</script>
		<script>
			const { app } = require('electron').remote;
			var remote = window.require('electron').remote;
			var fs = remote.require('fs');
			
			function dlinfo() {
				$('.download').html("Download Done!");
				$('.info').html('File will save to your "Photo Directory/nekos"').hide().fadeIn(1000);
				setTimeout(() => {
					$('.download').html("Download Img");
					$('.info').html('File will save to your "Photo Directory/nekos"').fadeOut(1000);
				}, 1500);
			}
			function GetFilename(url) {
				var URI = require('urijs');
				var url = new URI(url);
				$('.imgname').html(url.filename());
				return url.filename();
			}
			function DownloadImg(url) {
				$(".download").attr("disabled", "disabled");
				
				var imgmname = GetFilename(url);
				var request = require('request');

				var download = function(uri, filename, callback){	
					request.head(uri, function(err, res, body){
						console.log('content-type:', res.headers['content-type']);
						console.log('content-length:', res.headers['content-length']);
						
						fs.mkdir(app.getPath('pictures')+"/nekos/", { recursive: true }, (err) => {
							if (err) {
								throw err;
							}
						});
						request(uri).pipe(fs.createWriteStream(app.getPath('pictures')+"/nekos/"+filename)).on('close', callback);
					});
				};
				
				download(url, imgmname, function(){
					console.log('done');
					dlinfo();
				});
			}
			function CreateNEKO(type){
				switch (type) {
					case "nekobot":
						$.ajax({
							url: "https://nekobot.xyz/api/image?type=neko",
							type: "GET",
							success: function(returnData){
								var json1 = JSON.stringify(returnData);
								var jsonf = JSON.parse(json1);
								console.log(returnData);
								$(".imgput").attr("src",jsonf.message+" ");
								$(".url").html(jsonf.message);
								GetFilename(jsonf.message);
							}
						});
						break;
					case "nekos":
						const client = require('nekos.life');
						const {sfw} = new client();
						
						sfw.neko().then(neko => {
							var json1 = JSON.stringify(neko);
							var jsonf = JSON.parse(json1);
							console.log(neko);
							$(".imgput").attr("src",jsonf.url+" ");
							$(".url").html(jsonf.url);
							GetFilename(jsonf.url);
						});
						break;
					default:
						console.warn("You are not choose the image database!");
				}
			}
			function CreateNEKONSFW(type){
				switch (type) {
					case "nekobot":
						$.ajax({
							url: "https://nekobot.xyz/api/image?type=hentai",
							type: "GET",
 							success: function(returnData){
								var json1 = JSON.stringify(returnData);
								var jsonf = JSON.parse(json1);
								console.log(returnData);
								$(".imgput").attr("src",jsonf.message+" ");
								$(".url").html(jsonf.message);
								GetFilename(jsonf.message);
							}
						});
						break;
					case "nekos":
						const client = require('nekos.life');
						const {nsfw} = new client();
						
						nsfw.neko().then(neko => {
							var json1 = JSON.stringify(neko);
							var jsonf = JSON.parse(json1);
							console.log(neko);
							$(".imgput").attr("src",jsonf.url+" ");
							$(".url").html(jsonf.url);
							GetFilename(jsonf.url);
						});
						break;
					default:
						console.warn("You are not choose the image database!");
				}
			}
			function copyToClipboard(element) {
				var $temp = $("<input>");
				$("body").append($temp);
				$temp.val($(element).html()).select();
				document.execCommand("copy");
				$temp.remove();
			}
		</script>
	</head>
	<body>
		<dir class="site-content" style="">
			<h1>Neko Image Creater</h1>
			<br>
			<img src="" class="imgput" style="padding: 5px 5px;width: 25em;">
			<br>
			<h6><span class="info"></span></h6>
			<h5>Img Name: <span class="imgname"></span></h5>
			<h5>Img Site: <span class="url"></span><button onclick="copyToClipboard('.url')">Copy</button><button onclick="DownloadImg($('.url').html())" class="download">Download Img</button></h5>
			<h5>Img Database: <select class="imgtype"><option value="nekobot">Nekobot.xyz</option><option value="nekos">Nekos.life</option></select></h5>
			<h3><button onclick="CreateNEKO($('.imgtype').val());$('.download').removeAttr('disabled');" class="btneko">Create Nekos</button><button onclick="CreateNEKONSFW($('.imgtype').val());$('.download').removeAttr('disabled');" class="bthentai">Create Hentai</button></h3>
		</dir>
	</body>
</html>